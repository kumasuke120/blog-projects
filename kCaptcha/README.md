# kCaptcha
Captcha generator written in Kotlin.

## Introduction
A simple "library" for generating captcha images, whose type includes: `.jpg/.jpeg`, `.bmp`, `.png` and `.gif`.  
Due to the main purpose is serving for server-side, all classes in this "library" are **thread-safe**.  
Click [here](#samples) to see generated samples.

## Installation
### Requirements
* Java version: 1.6+
* Kotlin version: 1.1+ (use in Kotlin)

### Standalone version
Package the project with the following command:
```
$ mvn clean package
```
It bears noting that you could append `-Dmaven.test.skip=true` to skip the test goal.  
Then add the packaged jar `kCaptcha-<version>-jar-with-dependencies.jar` to your classpath, and there it is.  

_**Please Note**: standalone version carries a dependency of_ `org.jetbrains.kotlin:kotlin-stdlib:1.1.3-2`

### Install with Maven
Firstly, you should execute the following command to install the project to your local repository:
```
$ mvn clean install
```
As above, you could append `-Dmaven.test.skip=true` to skip the test goal.  
Once it has completed, you could add the following dependency to `pom.xml` of your own project, and Bob's your uncle,
you could use kCaptcha normally.
```xml
<dependency>
    <groupId>com.github.kumasuke120.captcha</groupId>
    <artifactId>kCaptcha</artifactId>
    <version>1.0-SNAPSHOT</version>
</dependency>
```
_**Please Note**: you could override Kotlin version by property_ `kotlin.version` _, which is_ `1.1.3-2` _by default_

## Usage
### Use in Kotlin
To generate captcha images, first you need to create a instance of `CaptchaGenerator`.  
You could use the `CaptchaGenerator.defaultGenerator()` to get the default one, which will generate `100x34` png image 
with 50 random mask lines and its length of captcha code will be 4:
```kotlin
val generator = CaptchaGenerator.defaultGenerator()
```
Or, you could create a instance with the `Builder`:
```kotlin
val generator: CaptchaGenerator = CaptchaGenerator.builder()
                .codeLength(8)
                .image(type = ImageType.BMP, width = 240, height = 40)
                .maskLineNumber(80)
                .build()
```
In the example above, the created `CaptchaGenerator` will generate 8-character `240x40` bmp format captcha image 
with 80 mask lines.  
Any unset property will employ the default one instead, which is same as the one in `defaultGenerator()`.

Once you've created your own instance of `CaptchaGenerator`, you could generate captcha image freely.
```kotlin
fun main(args: Array<String>) {
    val captcha: Captcha = generator.nextCaptcha()
    
    captcha.code              // random code
    captcha.imageBytes        // captcha image bytes in ByteArray
    captcha.type              // captcha image format
    captcha.toImageDataUri()  // converts image to Base64 encoded data uri, 
                              // such as 'data:image/png;base64, ...'
}
```

### Use in Java
Using kCaptcha in Java is quite same as that in Kotlin, here is the example code.
```java
public class Sample {
    public static void main(String[] args){
      CaptchaGenerator generator = CaptchaGenerator.defaultGenerator();
      Captcha captcha = generator.nextCaptcha();
      
      captcha.getCode();          // random code
      captcha.getImageBytes();    // captcha image bytes in byte[]
      captcha.getType();          // captcha image format
      captcha.toImageDataUri();   // converts image to Base64 encoded data uri, 
                                  // such as 'data:image/png;base64, ...'
    }
}
```

Using `Builder` in Java is also similar with the Kotlin version, excepting that there is no
default parameter value or named parameter in Java (Although you could choose from all three overloaded
versions of `Builder.image()`).
```java
public class Sample {
    public static void main(String[] args){
          CaptchaGenerator generator = CaptchaGenerator.builder()
                          .image(ImageType.BMP, 80, 30)
                          .codeLength(2)
                          .build();
          
          // your code goes here...
    }
}
```

## Samples
Here are some captcha generated by kCaptcha with different formats and appearances.

* 100x34, jpg, 4 characters, 50 mask lines  
  ![100x34,jpg,4,50](samp/100x34-4-50.jpg?raw=true)
* 100x34, png, 4 characters, 50 mask lines  
  ![100x34,png,4,50](samp/100x34-4-50.png?raw=true)
* 200x50, png, 6 characters, 80 mask lines  
  ![200x50,png,6,80](samp/200x50-6-80.png?raw=true)
* 240x40, bmp, 8 characters, 50 mask lines  
  ![240x40,bmp,8,50](samp/240x40-8-50.bmp?raw=true)
* 240x40, gif, 8 characters, 50 mask lines  
  ![240x40,gif,8,50](samp/240x40-8-50.gif?raw=true)
